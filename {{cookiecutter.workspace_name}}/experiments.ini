[pyrex]
workspace_root = {toxinidir}
package_dir = {[pyrex]workspace_root}{/}{{cookiecutter.package_name}}
lockfile = {[pyrex]workspace_root}{/}poetry.lock

[tox]
isolated_build = true
skipsdist = true
basepython = py{{cookiecutter.__python_version|replace('.','')}}

[testenv:example]
allowlist_externals =
    poetry

commands_pre = 
    python -c "import os; assert os.path.exists('{[pyrex]lockfile}')"
    poetry install -v
    poetry run pytest --pyargs {{cookiecutter.package_name}}

commands =
    poetry run python {[pyrex]package_dir}{/}main.py
    
