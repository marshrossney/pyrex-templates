# To create this experiment, type:
#
#       tox -c runcards/file.ini -- COMMIT
#
# where COMMIT is a SHA-1 hash pointing to a specific commit in this repository
# (it could also be a tag or head, but this is not recommended for reproducibility reasons)
[pyrex]
workspace = {toxinidir}
lockfile = {[pyrex]workspace}{/}poetry.lock

[tox]
requires = 
{%- if cookiecutter.use_conda | lower in ['true', 't', 'yes', 'y'] %}
    tox_conda
{%- endif %}

isolated_build = true
skipsdist = true
basepython = {{cookiecutter.__python_version}}

[testenv:default]
allowlist_externals =
    poetry
{%- if cookiecutter.use_conda | lower in ['true', 't', 'yes', 'y'] %}
    conda
{%- endif %}

{% if cookiecutter.use_conda | lower in ['true', 't', 'yes', 'y'] -%}
conda_spec =
    {[pyrex]workspace_dir}{/}conda_spec.txt
{%- endif %}

commands_pre = 
    python -c "import os; assert os.path.exists('{[pyrex]lockfile}')"
    poetry install -v
    poetry run pytest --pyargs {{cookiecutter.package_name}}

commands =
    
